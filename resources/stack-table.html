<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Security Stack Coverage Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://unpkg.com/tabulator-tables@5.6.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<script src="https://unpkg.com/tabulator-tables@5.6.3/dist/js/tabulator.min.js"></script>
<style>
  body{padding:2rem;background:#f8fafc;font-family:system-ui, -apple-system, BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif;}
  #mainRow{display:flex;flex-wrap:wrap;gap:2rem}
  #tableDiv{flex:1 1 600px;min-width:300px}
  #chartDiv{flex:1 1 400px;min-width:280px}
  .legend-box{display:inline-block;width:14px;height:14px;margin-right:6px;border-radius:2px}
</style>
</head>
<body>
<h1 class="mb-3">Security‑Stack Coverage Explorer</h1>

<div class="mb-3">
<span class="legend-box" style="background:#057a55"></span>Full&nbsp;
<span class="legend-box" style="background:#facc15"></span>Partial&nbsp;
<span class="legend-box" style="background:#dc2626"></span>None&nbsp;&nbsp;|&nbsp;&nbsp;
<span class="legend-box" style="background:#4d7c0f"></span>Complement&nbsp;
<span class="legend-box" style="background:#b45309"></span>Incremental&nbsp;
<span class="legend-box" style="background:#7f1d1d"></span>Replace&nbsp;
<span class="legend-box" style="background:#6b7280"></span>Low‑Priority
</div>

<div id="mainRow">
  <div id="tableDiv">
     <div id="stackTable"></div>
  </div>
  <div id="chartDiv" class="card p-3">
     <canvas id="radarChart" height="380"></canvas>
  </div>
</div>

<script>
// load JSON
fetch('stackMatrix.json')
 .then(r=>r.json())
 .then(data=>{
    // helper for badge
    const covColor=v=>v==1?'#057a55':v==0.5?'#facc15':'#dc2626';
    const fitColor={'Complementary':'#4d7c0f','Incremental':'#b45309','Replace Existing Tool':'#7f1d1d','Low Priority':'#6b7280'};
    const table=new Tabulator("#stackTable",{
        data:data,
        layout:"fitDataStretch",
        columns:[
           {title:"Stack",field:"stack",width:210,frozen:true},
           {title:"ATO",field:"ato",width:70,formatter:(c)=>`<span style="display:inline-block;width:100%;height:100%;background:${covColor(c.getValue())};border-radius:4px"></span>`},
           {title:"Phishing",field:"phishing",width:90,formatter:(c)=>`<span style="display:inline-block;width:100%;height:100%;background:${covColor(c.getValue())};border-radius:4px"></span>`},
           {title:"Insider",field:"insider",width:90,formatter:(c)=>`<span style="display:inline-block;width:100%;height:100%;background:${covColor(c.getValue())};border-radius:4px"></span>`},
           {title:"Gap",field:"gap",widthGrow:3},
           {title:"Fit",field:"fit",width:130,formatter:(c)=>`<span style="background:${fitColor[c.getValue()]};color:#fff;padding:2px 6px;border-radius:4px;font-size:0.8rem">${c.getValue()}</span>`}
        ],
        initialSort:[{column:"fit",dir:"asc"}],
        height:"600px",
    });

    // radar chart for selected row
    const ctx=document.getElementById('radarChart');
    const chart=new Chart(ctx,{
       type:'radar',
       data:{labels:["ATO","Phishing","Insider"],datasets:[{label:'',data:[0,0,0],backgroundColor:'rgba(59,130,246,0.3)',borderColor:'#3b82f6',pointBackgroundColor:'#3b82f6'}]},
       options:{responsive:true,plugins:{legend:{display:false}},scales:{r:{max:1,min:0,ticks:{stepSize:0.5}}}}
    });
    table.on("rowClick",(e,row)=>{
       const d=row.getData();
       chart.data.datasets[0].label=d.stack;
       chart.data.datasets[0].data=[d.ato,d.phishing,d.insider];
       chart.update();
    });
 });
</script>
</body>
</html>
