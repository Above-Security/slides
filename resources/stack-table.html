<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Above – Capability Explorer</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="tabulator.min.css" rel="stylesheet">
  <script src="tabulator.min.js"></script>
  <style>
    body { padding:2rem; font-family: ui-sans-serif,system-ui; background:#f5f5f5; }
    canvas { max-width: 800px; margin:auto; }
    #layout { display: flex; flex-wrap: wrap; gap: 2rem }
    #tableDiv { flex: 1 1 600px; min-width: 300px }
    #chartDiv { flex: 1 1 400px; min-width: 280px }
    .fit-badge { padding:2px 6px; border-radius:4px; color:#fff; font-size:0.85rem; }
  </style>
</head>
<body>
  <h1 class="text-2xl font-bold mb-6 text-center">Above vs. Other Stacks – Capability Explorer</h1>
  <div class="mb-4 text-center text-sm text-gray-700">
    Click a row to view its capability radar.
  </div>

  <div id="layout">
    <div id="tableDiv"><div id="stackTable"></div></div>
    <div id="chartDiv" class="card p-3"><canvas id="radarChart" height="400"></canvas></div>
  </div>

  <script>
  (async () => {
    try {
      const response = await fetch('./stackRadarData_clean.json');
      if (!response.ok) throw new Error('Data load failed');
      const data = await response.json();

      const categories = data.categories;
      const fitColors = {
        "Core": "#047857",
        "Complementary": "#4d7c0f",
        "Incremental": "#b45309",
        "Low Priority": "#6b7280",
        "Replace Existing Tool": "#7f1d1d"
      };
      const palette = ['#16a34a55','#3b82f655','#eab30855','#ef444455','#8b5cf655','#14b8a655'];

      const ctx = document.getElementById('radarChart').getContext('2d');
      const radarChart = new Chart(ctx, {
        type: 'radar',
        data: { labels: categories, datasets: [] },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom', labels: { boxWidth: 18 } }
          },
          scales: {
            r: {
              beginAtZero: true,
              max: 5,
              ticks: { stepSize: 1 },
              pointLabels: { font: { size: 12 } }
            }
          }
        }
      });

      const normalize = item => {
        const row = { Product: item.name, Fit: item.fit };
        categories.forEach((cat,i) => row[cat] = item.scores[i]);
        return row;
      };

      const tableData = [...data.vendors, data.core].map(normalize);
      let selectedProduct = null;

      const table = new Tabulator("#stackTable", {
        data: tableData,
        layout: "fitDataStretch",
      columns: [
        { title: "Product", field: "Product", width: 220, frozen: true },
        ...data.categories.map(cat => ({
          title: cat, field: cat,
          formatter:"progress", formatterParams:{min:0,max:5},
          width:120
        })),
        {
          title: "Sales Fit", field: "Fit", width:180,
          formatter: cell => {
            const f = cell.getValue();
            const c = fitColors[f]||"#999";
            return `<span class="fit-badge" style="background:${c}">${f}</span>`;
          },
          headerFilter: "input"
        }
      ],
      height: "600px",
      rowClick: (e,row) => {
        const d = row.getData();
        if (selectedProduct === d.Product) {
          radarChart.data.datasets = [];
          radarChart.update();
          selectedProduct = null;
          return;
        }

        const chartData = categories.map(cat => d[cat]);
        if (chartData.some(v => typeof v !== 'number')) return;

        selectedProduct = d.Product;
        const idx = row.getPosition();
        const color = palette[idx % palette.length];
        const border = color.replace('55', 'dd');

        radarChart.data.datasets = [{
          label: d.Product,
          data: chartData,
          fill: true,
          backgroundColor: color,
          borderColor: border,
          borderWidth: 2,
          pointRadius: 4
        }];
        radarChart.update();
      }
    });
  } catch(err) {
    console.error('Error loading data:', err);
  }
  })();
  </script>
</body>
</html>
